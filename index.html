<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÎÎµÏÎ® â€“ Demo UI</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    :root{
      --felt:#1f6b3a;
      --felt2:#1a5c32;
      --panel: rgba(0,0,0,.28);
      --line: rgba(255,255,255,.18);
      --txt: #f2f5f3;
      --muted: rgba(255,255,255,.75);
      --accent: #61dafb;
      --danger: #ff6b6b;
      --ok: #56f19a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 50% 35%, var(--felt) 0%, var(--felt2) 70%, #134325 100%);
      color:var(--txt);
    }
    .wrap{ max-width: 1400px; margin:0 auto; padding:18px; display:grid; grid-template-columns: 360px 1fr; gap:16px; }
    .panel{
      background: rgba(0,0,0,.30);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.22);
    }
    .panel h2{ margin:0 0 10px 0; font-size:18px; }
    .row{ display:flex; gap:8px; align-items:center; }
    .row > *{ flex:1; }
    input, select, button{ font: inherit; }
    input, select{
      width:100%;
      padding:9px 10px;
      border-radius:10px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      color: var(--txt);
      outline:none;
    }
    button{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.10);
      color: var(--txt);
      cursor:pointer;
    }
    button:hover{ background: rgba(255,255,255,.16); }
    .btn-primary{ border-color: rgba(97,218,251,.55); }
    .btn-ok{ border-color: rgba(86,241,154,.55); }
    .btn-danger{ border-color: rgba(255,107,107,.6); }

    .mini{ font-size:12px; color: var(--muted); line-height:1.35; margin-top:8px; }

    .table{
      background: rgba(0,0,0,.20);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      padding:14px;
      min-height: 82vh;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .topbar{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.22);
      color: rgba(255,255,255,.92);
      font-size:12px;
    }
    .pill.ok{ border-color: rgba(86,241,154,.45); }
    .pill.bad{ border-color: rgba(255,107,107,.55); }

    /* Card visuals */
    .card{
      width:72px; height:96px;
      border-radius:12px;
      background: #fff;
      color:#111;
      border:1px solid rgba(0,0,0,.12);
      box-shadow: 0 10px 20px rgba(0,0,0,.22);
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, outline-color .12s ease;
    }
    .card .corner{
      position:absolute;
      left:8px; top:8px;
      font-weight:800;
      font-size:14px;
      line-height:1.05;
      text-align:left;
    }
    .card .corner.bottom{
      left:auto; top:auto;
      right:8px; bottom:8px;
      transform: rotate(180deg);
    }
    .card .pip{ font-size:30px; }
    .card.red{ color:#c0392b; }
    .card.black{ color:#111; }
    .card.selected{ outline:3px solid rgba(97,218,251,.9); transform: translateY(-6px); }

    .card.back{
      background: linear-gradient(135deg, #234 0%, #456 55%, #234 100%);
      border:1px solid rgba(255,255,255,.25);
      color: rgba(255,255,255,.92);
      cursor:default;
    }
    .card.back::after{
      content:"â™ â™¥â™¦â™£";
      font-weight:800;
      letter-spacing:3px;
      opacity:.85;
    }

    .area{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .areaTitle{ font-size:12px; color: var(--muted); margin-bottom:8px; }

    .stack{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      padding:10px;
      border-radius:14px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      min-height:120px;
    }

    .json{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      white-space: pre-wrap;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px;
      max-height: 240px;
      overflow:auto;
    }

    .hint{
      padding:10px;
      border-radius:12px;
      border:1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.85);
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- LEFT PANEL -->
    <div class="panel">
      <h2>Controls</h2>

      <div class="row">
        <button class="btn-primary" id="btnAuthP1">Auth P1</button>
        <button class="btn-primary" id="btnAuthP2">Auth P2</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <input id="token_p1" placeholder="Token P1">
        <input id="token_p2" placeholder="Token P2">
      </div>

      <div style="height:10px"></div>

      <button class="btn-ok" id="btnCreate">Create (P1)</button>
      <div class="row" style="margin-top:8px;">
        <input id="game_id" placeholder="Game ID">
        <button class="btn-ok" id="btnJoin">Join (P2)</button>
      </div>

      <div style="height:10px"></div>

      <div class="row">
        <select id="active_player">
          <option value="p1">Î Î±Î¯Î¶Ï‰ Ï‰Ï‚ P1</option>
          <option value="p2">Î Î±Î¯Î¶Ï‰ Ï‰Ï‚ P2</option>
        </select>
        <button id="btnBoard">Board</button>
      </div>

      <div style="height:10px"></div>

      <button class="btn-primary" id="btnPlay">â–¶ Î Î±Î¯Î¾Îµ</button>
      <button class="btn-danger" id="btnClear" style="margin-top:8px;">Clear ÎµÏ€Î¹Î»Î¿Î³Î­Ï‚</button>

      <div class="mini">
         ÎšÎ»Î¹ÎºÎ¬ÏÎµÎ¹Ï‚ Î¼ÏŒÎ½Î¿ Ï†ÏÎ»Î»Î¿ Î±Ï€ÏŒ <b>Ï„Î¿ Î´Î¹ÎºÏŒ ÏƒÎ¿Ï…</b> Ï‡Î­ÏÎ¹. <br/>
         Î‘Î½ Ï„Î±Î¹ÏÎ¹Î¬Î¶ÎµÎ¹ Î¼Îµ Ï„Î¿ Ï€Î¬Î½Ï‰ Ï†ÏÎ»Î»Î¿ Î® ÎµÎ¯Î½Î±Î¹ Î’Î±Î»Î­Ï‚ â†’ Î¼Î±Î¶ÎµÏÎµÎ¹ (ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¿Ï…Ï‚ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ Ï„Î¿Ï… API).
      </div>

      <div class="hint" style="margin-top:12px;">
        <div><b>API URL</b></div>
        <div style="opacity:.9; margin-top:6px;">
          Î’ÎµÎ²Î±Î¹ÏÏƒÎ¿Ï… ÏŒÏ„Î¹ Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ ÏƒÏ„Î¿ ÏƒÏ‰ÏƒÏ„ÏŒ Ï†Î¬ÎºÎµÎ»Î¿:
          <div class="json" id="apiUrlBox"></div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div class="areaTitle">Î¤ÎµÎ»ÎµÏ…Ï„Î±Î¯Î± Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· API</div>
        <div class="json" id="json_output">{}</div>
      </div>
    </div>

    <!-- TABLE -->
    <div class="table">
      <div class="topbar">
        <div class="pill" id="pillGame">ğŸ® Game: --</div>
        <div class="pill" id="pillYou">ğŸ™‹ Î•ÏƒÏ: --</div>
        <div class="pill" id="pillTurn">â³ Turn: --</div>
        <div class="pill" id="pillDeck">ğŸ‚  Deck: --</div>
        <div class="pill" id="pillLiveScore">ğŸ† Score: P1 0 â€¢ P2 0</div>
        <div class="pill" id="pillCollected">ğŸ—‚ï¸ Collected: P1 0 â€¢ P2 0</div>
      </div>

      <div>
        <div class="areaTitle" id="oppTitle">Î‘Î½Ï„Î¯Ï€Î±Î»Î¿Ï‚</div>
        <div class="area" id="oppHand"></div>
      </div>

      <div>
        <div class="areaTitle">Î¤ÏÎ±Ï€Î­Î¶Î¹ (Î£Î¤ÎŸÎ™Î’Î‘)</div>
        <div class="stack" id="tablePile"></div>
      </div>

      <div>
        <div class="areaTitle" id="meTitle">Î•ÏƒÏ</div>
        <div class="area" id="myHand"></div>
      </div>
    </div>

  </div>

<script>
  // ğŸ”§ Î’Î‘Î›Î• Î•Î”Î© Î¤ÎŸ Î£Î©Î£Î¤ÎŸ PATH Î£ÎŸÎ¥
  const BASE_URL = "http://127.0.0.1/project_ADISE/ADISE25_2019131/api.php";
  $("#apiUrlBox").text(BASE_URL);

  let LAST = null;
  let SELECTED_HAND = null;

  function suitToPip(s){
    return ({H:"â™¥",D:"â™¦",C:"â™£",S:"â™ "})[s] || s;
  }
  function isRedSuit(s){ return (s==="H" || s==="D"); }

  function renderCard(code, clickable=true, selected=false){
    const suit = code.slice(-1);
    const rank = code.slice(0, -1);
    const pip = suitToPip(suit);
    const $c = $("<div>").addClass("card").addClass(isRedSuit(suit) ? "red" : "black");
    if(selected) $c.addClass("selected");
    $c.append($("<div>").addClass("corner").html(`${rank}<br>${pip}`));
    $c.append($("<div>").addClass("pip").text(pip));
    $c.append($("<div>").addClass("corner bottom").html(`${rank}<br>${pip}`));
    if(!clickable) $c.css("cursor","default");
    return $c;
  }
  function renderBack(){ return $("<div>").addClass("card back"); }

  function activeToken(){
    const who = $("#active_player").val();
    return (who === "p2") ? $("#token_p2").val().trim() : $("#token_p1").val().trim();
  }
  function activeMeKey(){
    return ($("#active_player").val() === "p2") ? "player2_hand" : "player1_hand";
  }
  function activeOppKey(){
    return ($("#active_player").val() === "p2") ? "player1_hand" : "player2_hand";
  }
  function activeMeLabel(){ return ($("#active_player").val() === "p2") ? "P2" : "P1"; }
  function activeOppLabel(){ return ($("#active_player").val() === "p2") ? "P1" : "P2"; }

  function refreshBoard(){
    const gid = $("#game_id").val().trim();
    if(!gid) return;
    $.ajax({
      url: BASE_URL + `?path=/games/${gid}`,
      method: "GET",
      success: (res) => {
        LAST = res;
        $("#json_output").text(JSON.stringify(res, null, 2));
        paint(res);
      },
      error: (xhr) => {
        const err = xhr.responseJSON || {status:"error", message: xhr.responseText || "Î£Ï†Î¬Î»Î¼Î±"};
        $("#json_output").text(JSON.stringify(err, null, 2));
      }
    });
  }

  function paint(res){
    const bs = res.board_state || {};
    const gid = $("#game_id").val() || "--";

    $("#pillGame").text(`ğŸ® Game: ${gid}`);
    $("#pillYou").text(`ğŸ™‹ Î•ÏƒÏ: ${activeMeLabel()}`);
    $("#pillDeck").text(`ğŸ‚  Deck: ${bs.deck ? bs.deck.length : "--"}`);
    //  Collected (Ï€Î¿ÏƒÎ± Ï†ÏÎ»Î»Î± Î­Ï‡ÎµÎ¹ Î¼Î±Î¶Î­ÏˆÎµÎ¹ Î¿ ÎºÎ±Î¸Î­Î½Î±Ï‚)
    const p1Collected = (bs.player1_collected || []).length;
    const p2Collected = (bs.player2_collected || []).length;

    // Live score (Ï€Î¬Î½Ï„Î± Î±ÏÎ¹Î¸Î¼Î¿Î¯ â€“ Ï€Î¿Ï„Î­ undefined)
    const ls = res.live_scores || {};
    const p1Score = (ls.player1_score ?? ls.player1 ?? 0);
    const p2Score = (ls.player2_score ?? ls.player2 ?? 0);

    //  Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· UI
    $("#pillLiveScore").text(` Score: P1 ${p1Score} â€¢ P2 ${p2Score}`);
    $("#pillCollected").text(` Collected: P1 ${p1Collected} â€¢ P2 ${p2Collected}`);

    // turn indicator
    const turn = res.current_turn ?? "--";
    const myId = ($("#active_player").val()==="p2") ? (res.player2_id ?? null) : (res.player1_id ?? null);
    const yourTurn = (myId !== null && turn === myId);

    $("#pillTurn")
      .text(
        ` Turn: ${turn}` +
        (myId ? (yourTurn ? " (Î•Î™ÎÎ‘Î™ Î— Î£Î•Î™Î¡Î‘ Î£ÎŸÎ¥!)" : " (Î Î•Î¡Î™ÎœÎ•ÎÎ• Î¤Î—Î Î£Î•Î™Î¡Î‘ Î£ÎŸÎ¥...)") : "")
      )
      .removeClass("ok bad")
      .addClass(yourTurn ? "ok" : "bad");

    // titles
    $("#meTitle").text(`Î•ÏƒÏ (${activeMeLabel()})`);
    $("#oppTitle").text(`Î‘Î½Ï„Î¯Ï€Î±Î»Î¿Ï‚ (${activeOppLabel()})`);

    // Opponent hand: backs equal to opponent length
    $("#oppHand").empty();
    const oppCount = (bs[activeOppKey()] || []).length;
    for(let i=0;i<oppCount;i++) $("#oppHand").append(renderBack());

    // Table pile: show stacked, NOT clickable
    $("#tablePile").empty();
    (bs.table_pile || []).forEach((c, idx) => {
      const $card = renderCard(c, false, false);
      $card.css("margin-left", idx===0 ? "0" : "-34px");
      $("#tablePile").append($card);
    });

    // My hand: clickable based on active player
    $("#myHand").empty();
    (bs[activeMeKey()] || []).forEach((c) => {
      const $card = renderCard(c, true, SELECTED_HAND === c);
      $card.on("click", () => {
        SELECTED_HAND = (SELECTED_HAND === c) ? null : c;
        paint(res);
      });
      $("#myHand").append($card);
    });
  }

  // Repaint on player switch (so hands swap)
  $("#active_player").on("change", () => {
    SELECTED_HAND = null;
    if(LAST) paint(LAST);
  });

  // Auth buttons
  $("#btnAuthP1").on("click", () => {
    $.ajax({
      url: BASE_URL + "?path=/auth",
      method: "POST",
      success: (res) => { $("#token_p1").val(res.token); $("#json_output").text(JSON.stringify(res,null,2)); },
      error: (xhr)=> $("#json_output").text(JSON.stringify(xhr.responseJSON||{},null,2))
    });
  });

  $("#btnAuthP2").on("click", () => {
    $.ajax({
      url: BASE_URL + "?path=/auth",
      method: "POST",
      success: (res) => { $("#token_p2").val(res.token); $("#json_output").text(JSON.stringify(res,null,2)); },
      error: (xhr)=> $("#json_output").text(JSON.stringify(xhr.responseJSON||{},null,2))
    });
  });

  $("#btnCreate").on("click", () => {
    const t = $("#token_p1").val().trim();
    if(!t) return alert("ÎšÎ¬Î½Îµ Ï€ÏÏÏ„Î± Auth P1");
    $.ajax({
      url: BASE_URL + "?path=/games",
      method: "POST",
      headers: { Authorization: "Bearer " + t },
      contentType: "application/json",
      success: (res) => {
        $("#game_id").val(res.game_id);
        $("#json_output").text(JSON.stringify(res,null,2));
        refreshBoard();
      },
      error: (xhr)=> $("#json_output").text(JSON.stringify(xhr.responseJSON||{},null,2))
    });
  });

  $("#btnJoin").on("click", () => {
    const gid = $("#game_id").val().trim();
    const t = $("#token_p2").val().trim();
    if(!gid) return alert("Î’Î¬Î»Îµ Game ID");
    if(!t) return alert("ÎšÎ¬Î½Îµ Ï€ÏÏÏ„Î± Auth P2");
    $.ajax({
      url: BASE_URL + `?path=/games/${gid}/join`,
      method: "POST",
      headers: { Authorization: "Bearer " + t },
      success: (res) => { $("#json_output").text(JSON.stringify(res,null,2)); refreshBoard(); },
      error: (xhr)=> $("#json_output").text(JSON.stringify(xhr.responseJSON||{},null,2))
    });
  });

  $("#btnBoard").on("click", refreshBoard);

  $("#btnClear").on("click", () => {
    SELECTED_HAND = null;
    if(LAST) paint(LAST);
  });

  $("#btnPlay").on("click", () => {
    const gid = $("#game_id").val().trim();
    if(!gid) return alert("Î’Î¬Î»Îµ Game ID");
    if(!SELECTED_HAND) return alert("Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï†ÏÎ»Î»Î¿ Î±Ï€ÏŒ Ï„Î¿ Ï‡Î­ÏÎ¹ ÏƒÎ¿Ï…");

    const token = activeToken();
    if(!token) return alert("Î›ÎµÎ¯Ï€ÎµÎ¹ token (ÎºÎ¬Î½Îµ auth ÏƒÏ„Î¿Î½ Ï€Î±Î¯ÎºÏ„Î·)");

    $.ajax({
      url: BASE_URL + `?path=/games/${gid}/move`,
      method: "POST",
      headers: { Authorization: "Bearer " + token },
      contentType: "application/json",
      data: JSON.stringify({
        player_card: SELECTED_HAND,
        table_cards: [] // Î´ÎµÎ½ ÎºÎ»Î¹ÎºÎ¬ÏÎ¿Ï…Î¼Îµ Ï„Î¿ Ï„ÏÎ±Ï€Î­Î¶Î¹
      }),
      success: (res) => {
        $("#json_output").text(JSON.stringify(res,null,2));
        SELECTED_HAND = null;
        refreshBoard();
      },
      error: (xhr) => {
        const err = xhr.responseJSON || {status:"error", message: xhr.responseText || "Î£Ï†Î¬Î»Î¼Î±"};
        $("#json_output").text(JSON.stringify(err,null,2));
      }
    });
  });
</script>
</body>
</html>






